!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.WebRTCAnalyzer=t():e.WebRTCAnalyzer=t()}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=1)}([function(e,t){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function r(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}e.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,n,o,a,l,h;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(s(n=this._events[e]))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(r(n))for(a=Array.prototype.slice.call(arguments,1),o=(h=n.slice()).length,l=0;l<o;l++)h[l].apply(this,a);return!0},n.prototype.addListener=function(e,t){var o;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?r(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,r(this._events[e])&&!this._events[e].warned&&(o=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.trace),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){if(!i(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var n,s,o,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(o=(n=this._events[e]).length,s=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(n)){for(a=o;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){s=a;break}if(s<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i(n=this._events[e]))this.removeListener(e,n);else if(n)for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){"use strict";n.r(t);const i="webrtc-analyzer",r="wa-header",s="wa-main";var o=n(0);const a=new(n.n(o).a);a.setMaxListeners(20);var l=a,h="NEW_ELEMENT",c="REMOVE_ELEMENT",d="CHANGE_VISIBILITY",u="TOGGLE_VISIBILITY";function m(e){return!0===e||!1===e}var p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};t.default=class{constructor(e){if(this.elements=[],this.options=p({},{interval:3e3,isVisible:!0},e),"number"!=typeof this.options.interval)throw new Error("[WebRTC-Analyzer]: interval has to be a number.");if(0==(!0===this.options.isVisible||!1===this.options.isVisible))throw new Error("[WebRTC-Analyzer]: isVisible has to be a boolean (true or false).");this.logic=new class{constructor(e){!function(e){const t=`<div class="wa-holder"><header class="${r}"><header>Select a PeerConnection</header></header><main class="${s}"><style>\n        .webrtc-analyzer {\n            position: fixed;\n            width: 0px;\n            height: 0px;\n            top: 0px;\n            left: 0px;\n            z-index: 99999999;\n            font-family: monaco, Consolas, "Lucida Console", monospace;\n            font-size: 12px;\n        }\n        .webrtc-analyzer.hidden .wa-holder {\n            left: 100%;\n        }\n        .webrtc-analyzer .wa-holder {\n            position: fixed;\n            z-index: 1;\n            box-shadow: rgba(0, 0, 0, 0.3) 0px 0px 4px;\n            background-color: #1e1f22;;\n            left: 70%;\n            top: 0px;\n            width: 30%;\n            height: 100%;\n            transition: left 0.2s ease-out, top 0.2s ease-out, width 0.2s ease-out, height 0.2s ease-out;\n        }\n        .webrtc-analyzer .wa-header {\n            background-color: #1e1f22;\n            position: absolute;\n            width: 100%;\n        }\n        .webrtc-analyzer .wa-header select {\n            width:100%;\n            height: 35px;\n            border: 0;\n            border-radius: 0;\n            background-color: #1e1f22;\n            color: rgb(129, 162, 190);\n            font-family: inherit;\n            font-size: 12px;\n            display: block;\n            padding: 0 10px;\n            box-sizing: border-box;\n            -webkit-appearance: none;\n            -moz-appearance: none;\n            appearance: none;\n            cursor:pointer;\n        }\n        .webrtc-analyzer .wa-main {\n            padding-top: 80px;\n            box-sizing: border-box;\n        }\n        .webrtc-analyzer .wa-main,\n        .webrtc-analyzer .wa-main .wa-stat {\n            height: 100%;\n        }\n        .webrtc-analyzer .wa-stat {\n            overflow: auto;\n        }\n        .webrtc-analyzer .wa-stat main {\n            width: 100%;\n            height: 100%;\n        }\n\n        .webrtc-analyzer .wa-stat table {\n            width: 100%;\n            table-layout: fixed;\n            border-collapse:collapse;\n        }\n\n        .webrtc-analyzer .wa-stat tr:nth-child(2n) {\n            background-color:#282a2d; \n            color: rgb(224, 224, 224);\n        }\n        \n        .webrtc-analyzer .wa-stat td {\n            padding: 3px 10px;\n            word-wrap: break-word;\n        }\n        \n        .webrtc-analyzer .wa-stat tr:nth-child(2n+1){\n            color: rgb(129, 162, 190)\n        }\n        \n        .webrtc-analyzer .wa-stat tr td:nth-child(2) {\n            color: rgb(181, 189, 104);\n        }\n\n        .webrtc-analyzer .wa-header header,\n        .webrtc-analyzer .wa-stat header {\n            color: #fff;\n            font-size: 14px;\n            padding: 10px 20px;\n            background-color: #383b40;\n            margin-bottom: 6px;\n        }\n    </style></main></div>`,n=document.createElement("div");n.classList.add(i),n.innerHTML=t,null!==document.querySelector("body")&&document.querySelector("body").appendChild(n)}(),this.isVisible=e.isVisible,this.interval=e.interval,this.activeId,this.intervalFn,this._onVisibilityChange=this._onVisibilityChange.bind(this),this._onToggleVisibility=this._onToggleVisibility.bind(this),this._setListeners(),this.isVisible&&this._onVisible()}_setListeners(){l.on(d,this._onVisibilityChange),l.on(u,this._onToggleVisibility)}_onVisibilityChange(e){this.activeId=e}_onToggleVisibility(){this.isVisible=!this.isVisible,!1===this.isVisible?this._onHidden():this._onVisible()}_onHidden(){document.querySelector(`.${i}`).classList.add("hidden"),clearInterval(this.intervalFn)}_onVisible(){document.querySelector(`.${i}`).classList.remove("hidden"),this.startReRenderingProcess()}startReRenderingProcess(){this.intervalFn=setInterval(()=>{l.emit(d,this.activeId)},this.interval)}destroy(){document.querySelector(`.${i}`).remove(),l.removeListener(d,this._onVisibilityChange),l.removeListener(u,this._onToggleVisibility),clearInterval(this.intervalFn)}}(this.options),this.navigation=new class{constructor(){this.elements={},this._onRemoveElement=this._onRemoveElement.bind(this),this._onNewElement=this._onNewElement.bind(this),this._setListener()}_setListener(){l.on(h,this._onNewElement),l.on(c,this._onRemoveElement)}_onRemoveElement(e){delete this.elements[e],this._render()}_onNewElement(e){let t=Object.keys(this.elements).length>0;l.emit(d,e),this.elements[e]=t,this._render()}_removeListener(){l.removeListener(h,this._onNewElement),l.removeListener(c,this._onRemoveElement)}_onChange(e){let t=e.target.value;l.emit(d,t);for(let e in this.elements)this.elements[e]=this.elements[e]===e}_render(){let e=document.createElement("select");for(let t in this.elements){let n=document.createElement("option");n.value=t,!0===this.elements[t]&&(n.value=t),n.innerText="RTCPeerConnection - "+t.slice(5),e.appendChild(n)}e.addEventListener("change",this._onChange),this._removeFromDOM(),this._addToDOM(e)}_addToDOM(e){document.querySelector(`.${i} .${r}`).appendChild(e)}_removeFromDOM(){let e=document.querySelector(`.${i} .${r}`).querySelector("select");null!==e&&(e.removeEventListener("change",this._onChange),e.remove())}destroy(){this._removeListener()}},this.keyhandler=new class{constructor(){this.handleKeyDown=this.handleKeyDown.bind(this),this.handleKeyUp=this.handleKeyUp.bind(this),this.isCTRLDown=!1,this.setListener()}setListener(){document.addEventListener("keydown",this.handleKeyDown),document.addEventListener("keyup",this.handleKeyUp)}handleKeyDown({keyCode:e}){17===e&&(this.isCTRLDown=!0)}handleKeyUp({keyCode:e}){17===e?this.isCTRLDown=!1:this.isCTRLDown&&72===e&&l.emit(u)}destroy(){document.removeEventListener("keydown",this.handleKeyDown),document.removeEventListener("keyup",this.handleKeyUp)}}}addPeerConnection(e){let t=new class{constructor(e){this.id=function(e,t,n,i){var r="",s="";for(isNaN(e)&&(e=32),m(t)||(t=!1),m(n)||(n=!0),m(i)||(i=!0),t&&(r+="ABCDEFGHIJKLMNOPQRSTUVWXYZ"),n&&(r+="abcdefghijklmnopqrstuvwxyz"),i&&(r+="0123456789");s.length<e;)s+=r.substr(Math.floor(r.length*Math.random()),1);return s}(10,!1,!0,!1),this.peerConnection=e,this.scrollTopPosition=0,this.isVisible=!1,this._onVisibilityChange=this._onVisibilityChange.bind(this),this._setListeners()}_setListeners(){l.on(d,this._onVisibilityChange)}_onVisibilityChange(e){let t=this.id===e;!0===t?(!0===this.isVisible&&(this._rememberScrollTop(),this._removeFromDOM()),this._render().then(()=>{this._setScrollTop()})):(this.scrollTopPosition=0,this._removeFromDOM()),this.isVisible=t}_rememberScrollTop(){null!==this._getElementFromDOM()&&(this.scrollTopPosition=this._getElementFromDOM().scrollTop)}_setScrollTop(){this._getElementFromDOM().scrollTop=this.scrollTopPosition}_getStats(){return this.peerConnection.getStats()}_generateHeader(e){return`<header>${e}</header>`}_generateFromPCState(e,t){return`<tr><td>${e}</td><td>${this.peerConnection[t]}</td></tr>`}_generateFromObject(e){let t="";return Object.keys(e).forEach(n=>{t+=`<tr><td>${n}</td><td>${e[n]}</td></tr>`}),t}_render(){return new Promise((e,t)=>{this._getStats().then(t=>{let n=document.createElement("div");n.classList.add("wa-stat"),n.id=this.id;let i='<div class="box"><main>';t.forEach(e=>{i+=this._generateHeader(function(e){return"certificate"===e?"Certificate":"codec"===e?"Codec":"candidate-pair"===e?"Candidate Pair":"remote-candidate"===e?"Remote candidate":"local-candidate"===e?"Local candidate":"inbound-rtp"===e?"Inbound RTP":"track"===e?"Track":"stream"===e?"Stream":"outbound-rtp"===e?"Outbound RTP":"peer-connection"===e?"Peer connection":"transport"===e?"Transport":"Unknown"}(e.type)),i+="<table>",i+=this._generateFromObject(e),i+="</table>"}),i+=this._generateHeader("PeerConnection states"),i+="<table>",i+=this._generateFromPCState("Signaling state","signalingState"),i+=this._generateFromPCState("ICE gathering state","iceGatheringState"),i+=this._generateFromPCState("ICE Connection state","iceConnectionState"),i+=this._generateFromPCState("Connection state","connectionState"),i+="</table>",i+="</main></div>",n.innerHTML=i,this._addToDOM(n),e()},t)})}_getElementFromDOM(){return document.querySelector(`.${i} #${this.id}`)}_addToDOM(e){document.querySelector(`.${i} .${s}`).appendChild(e)}_removeFromDOM(){null!==this._getElementFromDOM()&&this._getElementFromDOM().remove()}destroy(){l.removeListener(d,this._onVisibilityChange),this._removeFromDOM()}}(e);return this.elements.push(t),l.emit(h,t.id),t.id}removePeerConnection(e){this.elements=this.elements.filter(function(t){let n=t.id!==e;return!0===n&&(t.destroy(),l.emit(c,t.id)),n})}_removeAll(){this.elements.forEach(e=>{e.destroy()}),this.elements=[]}destroy(){this._removeAll(),this.keyhandler.destroy(),this.navigation.destroy(),this.logic.destroy(),l.removeAllListeners()}}}]).default});